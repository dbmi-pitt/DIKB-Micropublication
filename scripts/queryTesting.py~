import sys, os, datetime
sys.path.append('.')
from SPARQLWrapper import SPARQLWrapper, JSON


QUERIES_PATH = "../queries/"

def readCSVfromDir(inputdir):
    queriesD = {}

    for fname in os.listdir(inputdir):
        if fname.endswith(".sparql"):
            with open(inputdir + fname) as f:
                query = f.read()
                queriesD[fname] = query

    return queriesD


################################################################################
## MAIN TESTING
################################################################################

queriesD = readCSVfromDir(QUERIES_PATH)
sparql = SPARQLWrapper("https://dbmi-icode-01.dbmi.pitt.edu/sparql")

for name,qry in queriesD.items():
    
    print "[INFO] testing query (%s): \n %s" % (name, qry)
    sparql.setQuery(qry)    
    sparql.setReturnFormat(JSON)
    results = sparql.query().convert()
    
    if len(results["results"]["bindings"]) == 0:
        print "[DEBUG] query : %s is not getting any results back" % (name) 
